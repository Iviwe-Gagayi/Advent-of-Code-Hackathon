#include <iostream>
#include <vector>
#include <string>
#include <sstream>
#include <map>

// The raw puzzle input provided in the prompt
const std::string INPUT_DATA = R"(......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^.^.^....................................................................
.............................................................................................................................................
...................................................................^.^...^...................................................................
.............................................................................................................................................
..................................................................^.^.^.^.^..................................................................
.............................................................................................................................................
.................................................................^.^.^...^.^.................................................................
.............................................................................................................................................
................................................................^.^.^...^.^.^................................................................
.............................................................................................................................................
...............................................................^...^...^.^.^.^...............................................................
.............................................................................................................................................
..............................................................^.^.^...^...^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^.^...^.^...^.^.^.............................................................
.............................................................................................................................................
............................................................^.....^.^.^.^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^...^.^...^.^...^...^.^...........................................................
.............................................................................................................................................
..........................................................^.^.^.^.^...^...^.^.....^..........................................................
.............................................................................................................................................
.........................................................^.^.^...^.^.^...^...^.....^.........................................................
.............................................................................................................................................
........................................................^.^.....^.^.^.^.^.^.^.^.^...^........................................................
.............................................................................................................................................
.......................................................^...^.^.^.^.^...^...^.^...^.^.^.......................................................
.............................................................................................................................................
......................................................^.^.^.^...^.......^...^.....^.^.^......................................................
.............................................................................................................................................
.....................................................^.^.^...^.^.^.^.^.^.^.^.^.^.^...^.^.....................................................
.............................................................................................................................................
....................................................^.^.^.....^...^.^.^.^.^.^.^.^.^.^.^.^....................................................
.............................................................................................................................................
...................................................^.^.....^.^.^...^...^.^.^.^...^.......^...................................................
.............................................................................................................................................
..................................................^...^.......^.....^...^.^.^.^.^.^...^...^..................................................
.............................................................................................................................................
.................................................^.^.^.....^.^.^.^...^.^...^.^.^.^.^...^.^.^.................................................
.............................................................................................................................................
................................................^.^.^...^.^...^.^.......^...^...^.^.^.^.^.^.^................................................
.............................................................................................................................................
...............................................^.........^...^.^.......^.....^.^.^...^.^.^.^.^...............................................
.............................................................................................................................................
..............................................^.^.^.^.^.^...^.^.....^...^.^.^...^...^.^...^.^.^..............................................
.............................................................................................................................................
.............................................^...^.^.^.......^.....^.^.^.^...^.^.....^.^.....^.^.............................................
.............................................................................................................................................
............................................^...^...^.^.^...^...^.^.^...^...^.....^.^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^.....^...^.....^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^...........................................
.............................................................................................................................................
..........................................^.^.^...^...^.^.....^...^.......^.^...^.^.^.^...^.^...^.^..........................................
.............................................................................................................................................
.........................................^.^.^...^...^.^.^.^...^.^...^.^.^.^...^.....^.^.^.^.^...^.^.........................................
.............................................................................................................................................
........................................^.^.^...^...^.^.^.^.....^.^.......^.....^...^.^.^.^.^.....^.^........................................
.............................................................................................................................................
.......................................^.^.^...^.^.^...^.^.^.^.^.^...^.^...^.^.^.........^.^.^.....^.^.......................................
.............................................................................................................................................
......................................^.^.^...^.....^.^.^.^.....^...^.......^.^.....^.^.^...^...^...^.^......................................
.............................................................................................................................................
.....................................^.^.^.^...^.....^.....^.^.^.^.....^.^.^.....^.^...............^...^.....................................
.............................................................................................................................................
....................................^.^.^.^.....^.^.^...^...^.....^.^.^.^.^.^.^.^.^.^...^.^.^...^.^.^.^.^....................................
.............................................................................................................................................
...................................^...^.^...^.....^.^...^...^.^.^.^...^...^.....^.....^.^...^.^.^...^.^.^...................................
.............................................................................................................................................
..................................^.^.^.^.......^...^.^.^.^...^.....^.^...^.^.^...^.^.^.^.^.^.^...^.^...^.^..................................
.............................................................................................................................................
.................................^.....^.^.^.....^.....^.^.^.^.^.^...^.........^.^.^.^.^.....^...^.^.^.^...^.................................
.............................................................................................................................................
................................^.^.^.^.^.^.^.^...^.^.......^.^.....^.^.^.^...^...^.^.^.......^...^.......^.^................................
.............................................................................................................................................
...............................^.^...^.^...^...^.^.^.^.^...^.^...^.^...^...^...^...^.^.^.^.^.^...^...^.^...^.^...............................
.............................................................................................................................................
..............................^.^...^.^...^...^...^.^.^.^...^...^.^.....^.^...^.^.^...^.^.^.^...^.^.^.^.^.^.^.^..............................
.............................................................................................................................................
.............................^.^.........^.^.^.....^.^.^...^.^.^.^.^.^.^...^...^.^...^...^.^.....^.^.^.^.^.^.^.^.............................
.............................................................................................................................................
............................^.^.^...^...^.^.....^.......^...^.^...^...^.^.....^...^.^.....^.^.^...^.^.^.^.^.....^............................
.............................................................................................................................................
...........................^.^.^...^.^...^.^.^...^.^.^.^.^...^.^.^...^.^.^.^.....^...^...^.^...^...^.^.^...^.^.^.^...........................
.............................................................................................................................................
..........................^...^.......^.^.^.^.^.....^.^.....^.^.^.^.^.^...^.^.......^.^...^.^.^...^...^...^.^.^...^..........................
.............................................................................................................................................
.........................^.^.^.^.^...^...^.^.^.^...^.^...^...^...^.^.^.^.^.^.....^...^.^.^.^.^.^.^.....^.^.^.^.....^.........................
.............................................................................................................................................
........................^.^...^.^.^.^.^.^.....^.^.^.^.^...^.^.^...^.^.....^.^.....^...^.....^.^.^.^.^.^.^.^.^.....^.^........................
.............................................................................................................................................
.......................^.^.^.^.....^.^.....^.^...^.^...........^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.......................
.............................................................................................................................................
......................^.^.^...^.^...^.^.^.^.^.^.........^.....^.^.....^.^.^.^...^...^...^.^.^.^.^.^.^...^.^.......^.^.^......................
.............................................................................................................................................
.....................^.^.^...^.^...^...^.....^.^.^...^.^.^...^.^...^...^...^.^.^.^.^...^.^...^.^.^...^...^.^.^.^.^.....^.....................
.............................................................................................................................................
....................^.^.....^.....^.^.^.^.^.^.^.^.^.^...^...^.^.....^.^.^.^...^...^...^.^.^.^.^...^.^.....^.^...^...^.^.^....................
.............................................................................................................................................
...................^.^...^...^...^.^.........^...^.^...^...^.^.^.^.^.^.^.^.^.^.^...^.^...^...^.^.^.^.^...^...^.^.^.^...^.^...................
.............................................................................................................................................
..................^.^.....^.^.^.....^...^.^.^.^.^.^...^.^.....^.^...^...^.^.^...^.^...^.^.^.^.^...^...^.^...^.^.^.^.^...^.^..................
.............................................................................................................................................
.................^...^.^...^.^.^...^.....^.^.^.^...^...^...^.^...^.^.^.^.^.^.^.^...^.^.^.^.^.....^...^.^...^...^.^...^.^...^.................
.............................................................................................................................................
................^.......^.^.^...^.^.....^.^.....^...^...^.........^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^.^.^...^.^...^...^.^.^.^.^................
.............................................................................................................................................
...............^.^.^.^...^.^...^.^.^.^.......^.^.....^.^.^.^.^.^.^.^.^.....^...^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.^...^...^.^...............
.............................................................................................................................................
..............^.^.....^...^...^...^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.....^.^.^...^.....^...^.^.^.^.^.^.^.^.^...^.^.^.^.^.^...^..............
.............................................................................................................................................
.............^.^.^.^.^.^.....^.....^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.....^...^.^.......^...^.^.^.^.....^.^.^.^.^.^.^.....^.^.^.^.............
.............................................................................................................................................
............^...^...^.^.^.......^.^.^...^...^...^.^.^.^...^.^.^.^.....^...^...^.^.^.^.^.^.^.^...^.^.^.^.^.^...^.^.....^.^...^.^.^............
.............................................................................................................................................
...........^.^.......^.^.^.^.......^.^.^...^...^.^.^.^.^.^.^.^.^.......^.^.^.^.^.^.....^.^...^.^.^.....^.^.^.^...^.^...^.^.^...^.^...........
.............................................................................................................................................
..........^.^...^...^.....^.^.......^.^.^.^.^.^.^.^.^.^...^.^.^.^.....^...^.^.....^.^.^...^.^.....^.......^...^.^.^...^.^.^.^.^.^.^..........
.............................................................................................................................................
.........^...^.^.^.^.......^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.......^.^.^...^.^...^.^...^.....^...^.^.^...^.....^.^...^.^.^.^.........
.............................................................................................................................................
........^.^.......^.^.^.^.^.^...^.....^...^.......^.^.^.^...^.^...^.....^.....^.^.....^.^.^.......^.^.^.^.^.....^...^.^...^.^.^.^.^.^........
.............................................................................................................................................
.......^.^.^.^.......^.^.^...^.^.^.^.^.^...^.^.^...^.^.^.^...^.^.^.^.^.^...^.^...........^.^...^.^...^.^.....^.^.^.......^.^.^...^.^.^.......
.............................................................................................................................................
......^.^...^.^...^.^.^.^.....^...^.^...^.....^.^...^.^.^.....^.^.^.........^.....^.^.....^.^.^.^.^.^...^.^.^...^...^.....^.^.^.^.^.^.^......
.............................................................................................................................................
.....^.^.....^.^.^.^.^.^.^...^.^...^...^...^.^.^.....^.^...^.....^...^.^.^.^.^.^.^...^.^.^.^.^.^.^...^.^.....^.^.^.^.....^.^...^.^.^...^.....
.............................................................................................................................................
....^.^...^.^...^.^.^.^.^.^.^.^.....^...^.......^.^.^.^.^...^.......^.^.^.^.......^.............^.^.^.^.^.^.^...^.^.^.^.....^.^.^.^.....^....
.............................................................................................................................................
...^.^.^.^.^.^.^.^.^.^.^.^...^...^.^...^...^.^.^.^...^.^.^.^.^.^.^...^.^.^...^.....^.^.^.^.^.^.^.^.^.^...^.^...^.^.^.^.....^.^...^.....^.^...
.............................................................................................................................................
..^...^.^.^.^.^...^.^.^.^...^...^...^.^.....^...^.....^.^.....^.^.^...^.^.^...^.^...^...^...^.^.^...^.^...^.^.....^.^...^.^.....^...^...^.^..
.............................................................................................................................................
.^.^.......^...^.^...^.^...^.^...^.^.^.^.^.........^.^.......^.^.^.......^.^.^.^.^.^...^.^...^.^.......^.....^.^.^.^.^.^.^.^...^...^.^...^.^.
.............................................................................................................................................)";

int main() {

    std::vector<std::string> grid;
    std::stringstream ss(INPUT_DATA);
    std::string line;
    while (std::getline(ss, line)) {
        if (!line.empty()) {
            grid.push_back(line);
        }
    }



    std::map<int, long long> current_timelines;


    size_t start_pos = grid[0].find('S');
    if (start_pos != std::string::npos) {
        current_timelines[static_cast<int>(start_pos)] = 1;
    }

    int width = grid[0].length();
    int height = grid.size();


    for (int r = 0; r < height; ++r) {
        std::map<int, long long> next_timelines;

        for (auto const& [col, count] : current_timelines) {

            if (col < 0 || col >= width) continue;

            char current_char = grid[r][col];

            if (current_char == '^') {

                if (col - 1 >= 0) {
                    next_timelines[col - 1] += count;
                }
                if (col + 1 < width) {
                    next_timelines[col + 1] += count;
                }
            }
            else {

                next_timelines[col] += count;
            }
        }

        current_timelines = next_timelines;

        if (current_timelines.empty()) break;
    }


    long long total_timelines = 0;
    for (auto const& [col, count] : current_timelines) {
        total_timelines += count;
    }

    std::cout << "Total distinct timelines: " << total_timelines << std::endl;

    return 0;
}